<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="cn.yichen.propertymgt.admin.mapper.IUserInfoMapper">

	<cache />

	<resultMap id="UserInfoMap" type="UserInfo">
		<id column="USERID" property="id" />
		<result column="UNAME" property="username" />
		<result column="UPASSWORD" property="password" />
		<result column="SEX" property="sex" />
		<result column="AGE" property="age" />
		<result column="Mobible" property="mobible" />
		<result column="UserStatus" property="status" />
	</resultMap>

	<resultMap id="UserInfoMapWithFunction" type="UserInfo"
		extends="UserInfoMap">
		<collection property="functions" resultMap="cn.yichen.propertymgt.admin.mapper.ISystemFunctionMapper.SystemFunctionMapWithModule">
			<!-- select="cn.yichen.propertymgt.admin.mapper.ISystemFunctionMapper.selectFunctionByNoWithModule"> -->
			
		</collection>
	</resultMap>

	<sql id="userInfoWhen">
		<if test="userInfo != null">
			<if test="userInfo.id != null"> and USERID like '%${userInfo.id}%' </if>
			<if test="userInfo.password != null"> and UPASSWORD = #{userInfo.password} </if>
			<if test="userInfo.username != null"> and UNAME like '%${userInfo.username}%' </if>
			<if test="userInfo.mobible != null"> and Mobible like '%${userInfo.mobible}%' </if>
			<if test="userInfo.age != null"> and age = #{userInfo.age} </if>
			<if test="userInfo.sex != null"> and SEX = #{userInfo.sex} </if>
			<if test="userInfo.status != null"> and UserStatus = #{userInfo.status} </if>
		</if>
	</sql>

	<select id="selectUserInfoById"
		resultMap="UserInfoMapWithFunction">
		select u.USERID, UPASSWORD, UNAME, UserStatus, AGE, SEX,
		Mobible ,FUNNO
		from UserInfo u, SystemFunctionUser fu
		where u.USERID =
		#{id} and u.USERID = fu.USERID
	</select>

	<select id="selectListByAll" resultMap="UserInfoMap">
		select USERID, UPASSWORD, UNAME, UserStatus, AGE, SEX, Mobible
		from
		UserInfo
		<where>
			<include refid="userInfoWhen"></include>
		</where>
	</select>

	<select id="selectListByAllWithPage" resultMap="UserInfoMap">
		select USERID, UPASSWORD, UNAME, UserStatus, AGE, SEX, Mobible
		from
		UserInfo
		<where>
			<include refid="userInfoWhen"></include>
			and USERID >= (SELECT USERID FROM UserInfo ORDER BY USERID LIMIT
			#{start}, 1) LIMIT #{rows}
		</where>
	</select>

	<insert id="addFunctions">
		insert into SystemFunctionUser(USERID, FUNNO)
		values
		<foreach collection="funNos" item="funNo" separator=",">
			(#{id},
			#{funNo})
		</foreach>
	</insert>
</mapper>